<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Inkling - Digital Notes{% endblock %}</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Dancing+Script:wght@400;500;600;700&family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'lapis_lazuli': { 
                            DEFAULT: '#2f6690', 
                            100: '#09141c', 
                            200: '#122839', 
                            300: '#1c3c55', 
                            400: '#255172', 
                            500: '#2f6690', 
                            600: '#3e87bf', 
                            700: '#6da5d0', 
                            800: '#9ec3e0', 
                            900: '#cee1ef' 
                        }, 
                        'cerulean': { 
                            DEFAULT: '#3a7ca5', 
                            100: '#0c1921', 
                            200: '#173242', 
                            300: '#234b64', 
                            400: '#2f6485', 
                            500: '#3a7ca5', 
                            600: '#569ac4', 
                            700: '#80b3d2', 
                            800: '#aacce1', 
                            900: '#d5e6f0' 
                        }, 
                        'platinum': { 
                            DEFAULT: '#d9dcd6', 
                            100: '#2b2f28', 
                            200: '#575e50', 
                            300: '#828c78', 
                            400: '#adb4a7', 
                            500: '#d9dcd6', 
                            600: '#e0e3de', 
                            700: '#e8eae6', 
                            800: '#f0f1ee', 
                            900: '#f7f8f7' 
                        }, 
                        'indigo_dye': { 
                            DEFAULT: '#16425b', 
                            100: '#040d12', 
                            200: '#091a24', 
                            300: '#0d2736', 
                            400: '#123448', 
                            500: '#16425b', 
                            600: '#256f9a', 
                            700: '#3f9bd0', 
                            800: '#7fbce0', 
                            900: '#bfdeef' 
                        }, 
                        'sky_blue': { 
                            DEFAULT: '#81c3d7', 
                            100: '#102c34', 
                            200: '#215768', 
                            300: '#31839c', 
                            400: '#4ba9c6', 
                            500: '#81c3d7', 
                            600: '#99cedf', 
                            700: '#b2dbe7', 
                            800: '#cce7ef', 
                            900: '#e5f3f7' 
                        }
                    },
                    fontFamily: {
                        'apricot': ['Apricot', 'serif'],
                        'sans': ['Inter', 'ui-sans-serif', 'system-ui', 'sans-serif']
                    },
                    backgroundImage: {
                        'gradient-inkling': 'linear-gradient(135deg, #16425b, #2f6690, #3a7ca5, #81c3d7, #d9dcd6)',
                        'gradient-inkling-reverse': 'linear-gradient(135deg, #d9dcd6, #81c3d7, #3a7ca5, #2f6690, #16425b)',
                        'gradient-inkling-horizontal': 'linear-gradient(90deg, #16425b, #2f6690, #3a7ca5, #81c3d7, #d9dcd6)'
                    }
                }
            }
        }
    </script>
    
    <!-- Custom Inkling Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/inkling.css') }}">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-indigo_dye to-platinum min-h-screen">
    <!-- Navigation -->
    {% if current_user.is_authenticated %}
    <nav class="bg-white/95 backdrop-blur-sm border-b border-platinum/30 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="{{ url_for('main.dashboard') }}" class="flex items-center">
                        <span class="inkling-logo text-2xl font-bold">Inkling</span>
                    </a>
                    <div class="hidden md:ml-10 md:flex md:space-x-8 md:items-center">
                        <a href="{{ url_for('main.dashboard') }}" 
                           class="text-indigo_dye hover:text-lapis_lazuli font-medium px-3 py-2 rounded-md text-sm transition-colors">
                            Dashboard
                        </a>
                        <a href="{{ url_for('notes.list_notes') }}" 
                           class="text-indigo_dye hover:text-lapis_lazuli font-medium px-3 py-2 rounded-md text-sm transition-colors">
                            Notes
                        </a>
                        <a href="{{ url_for('subjects.list_subjects') }}" 
                           class="text-indigo_dye hover:text-lapis_lazuli font-medium px-3 py-2 rounded-md text-sm transition-colors">
                            Subjects
                        </a>
                        <a href="{{ url_for('chatbot.chatbot_interface') }}" 
                           class="text-indigo_dye hover:text-lapis_lazuli font-medium px-3 py-2 rounded-md text-sm transition-colors">
                            AI Assistant
                        </a>
                        
                        <!-- Search Bar inline with nav -->
                        <div class="ml-6">
                            <label for="search" class="sr-only">Search notes</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-search text-cerulean"></i>
                                </div>
                                <input id="search" name="search" 
                                       class="block w-full pl-10 pr-3 py-2 rounded-full border border-platinum/50 bg-white/80 placeholder-cerulean focus:outline-none focus:ring-2 focus:ring-sky_blue focus:border-sky_blue sm:text-sm" 
                                       placeholder="Search notes..." type="search" style="width: 250px;">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- User Menu -->
                <div class="flex items-center space-x-4">
                    <a href="{{ url_for('notes.create_note') }}" 
                       class="btn-gradient flex items-center px-4 py-2 text-sm font-medium text-white rounded-full hover:shadow-lg transition-all duration-200">
                        <i class="fas fa-plus mr-2"></i>
                        New Note
                    </a>
                    <div class="relative">
                        <button id="user-menu-button" 
                                class="flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky_blue">
                            <span class="sr-only">Open user menu</span>
                            {% if current_user.profile_image_data %}
                                <img src="{{ url_for('profile.profile_image', user_id=current_user.id) }}" 
                                     alt="Profile" 
                                     class="h-8 w-8 rounded-full object-cover ring-2 ring-sky_blue">
                            {% else %}
                                <div class="h-8 w-8 rounded-full bg-gradient-to-r from-lapis_lazuli to-cerulean flex items-center justify-center">
                                    <span class="text-white font-medium font-apricot">{{ current_user.username[0].upper() }}</span>
                                </div>
                            {% endif %}
                        </button>
                        <div id="user-menu" 
                             class="hidden origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-platinum ring-opacity-5 z-50">
                            <div class="py-1">
                                <a href="{{ url_for('profile.view_profile') }}" class="block px-4 py-2 text-sm text-indigo_dye hover:bg-sky_blue/20 hover:text-lapis_lazuli transition-colors">
                                    Profile
                                </a>
                                <a href="{{ url_for('auth.logout') }}" 
                                   class="block px-4 py-2 text-sm text-indigo_dye hover:bg-sky_blue/20 hover:text-lapis_lazuli transition-colors">
                                    Sign out
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile menu -->
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="{{ url_for('main.dashboard') }}" 
                   class="text-thistle-200 hover:text-white block px-3 py-2 rounded-md text-base font-medium transition-colors">
                    Dashboard
                </a>
                <a href="{{ url_for('notes.list_notes') }}" 
                   class="text-thistle-200 hover:text-white block px-3 py-2 rounded-md text-base font-medium transition-colors">
                    Notes
                </a>
                <a href="{{ url_for('subjects.list_subjects') }}" 
                   class="text-thistle-200 hover:text-white block px-3 py-2 rounded-md text-base font-medium transition-colors">
                    Subjects
                </a>
            </div>
        </div>
    </nav>
    {% endif %}

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="fixed top-4 right-4 z-50 space-y-2">
                {% for category, message in messages %}
                    <div class="alert-inkling-{{ category }} max-w-sm rounded-lg shadow-lg p-4 backdrop-blur-sm">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                {% if category == 'success' %}
                                    <i class="fas fa-check-circle text-uranian_blue-400"></i>
                                {% elif category == 'error' %}
                                    <i class="fas fa-exclamation-circle text-carnation_pink-400"></i>
                                {% elif category == 'warning' %}
                                    <i class="fas fa-exclamation-triangle text-fairy_tale-400"></i>
                                {% else %}
                                    <i class="fas fa-info-circle text-thistle-400"></i>
                                {% endif %}
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium">{{ message }}</p>
                            </div>
                            <div class="ml-auto pl-3">
                                <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                        class="text-thistle-300 hover:text-thistle-100 transition-colors">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main class="{% if current_user.is_authenticated and request.endpoint != 'chatbot.chatbot_interface' %}py-6{% endif %}">
        {% block content %}{% endblock %}
    </main>

    <!-- JavaScript -->
    <script>
        // User menu toggle
        document.getElementById('user-menu-button')?.addEventListener('click', function() {
            const menu = document.getElementById('user-menu');
            menu.classList.toggle('hidden');
        });

        // Close user menu when clicking outside
        document.addEventListener('click', function(event) {
            const button = document.getElementById('user-menu-button');
            const menu = document.getElementById('user-menu');
            if (button && menu && !button.contains(event.target) && !menu.contains(event.target)) {
                menu.classList.add('hidden');
            }
        });

        // Auto-hide flash messages
        setTimeout(() => {
            document.querySelectorAll('.alert').forEach(alert => {
                alert.style.opacity = '0';
                alert.style.transition = 'opacity 0.5s';
                setTimeout(() => alert.remove(), 500);
            });
        }, 5000);

        // Real-time search functionality
        const searchInput = document.getElementById('search');
        if (searchInput) {
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const query = this.value.trim();
                
                if (query.length > 2) {
                    searchTimeout = setTimeout(() => {
                        // Implement search functionality here
                        window.location.href = `{{ url_for('notes.list_notes') }}?q=${encodeURIComponent(query)}`;
                    }, 300);
                }
            });
        }
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>
